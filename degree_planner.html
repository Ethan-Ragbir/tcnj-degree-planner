<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCNJ Physics Major - Interactive Course Planner</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            color: #e2e8f0;
            overflow-x: auto;
        }

        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            background: rgba(15, 15, 35, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
            padding: 1.5rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header-title {
            display: flex;
            flex-direction: column;
        }

        .header-title h1 {
            font-size: 1.75rem;
            font-weight: 700;
            background: linear-gradient(135deg, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-title p {
            font-size: 0.875rem;
            color: #94a3b8;
            font-weight: 400;
        }

        .header-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.75rem;
            font-weight: 500;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }

        .btn-secondary {
            background: rgba(148, 163, 184, 0.1);
            color: #e2e8f0;
            border: 1px solid rgba(148, 163, 184, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(148, 163, 184, 0.2);
        }

        /* Stats Bar */
        .stats-bar {
            background: rgba(15, 15, 35, 0.8);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        }

        .stats-content {
            max-width: 1600px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 2rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #60a5fa;
            display: block;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 0.25rem;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 2rem;
        }

        .planner-container {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Semester Grid */
        .semester-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .semester {
            background: rgba(15, 15, 35, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.1);
            border-radius: 1rem;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .semester:hover {
            border-color: rgba(96, 165, 250, 0.3);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .semester-header {
            background: linear-gradient(135deg, #1e293b, #334155);
            padding: 1.25rem;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        }

        .semester-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #f1f5f9;
            margin-bottom: 0.25rem;
        }

        .semester-credits {
            font-size: 0.875rem;
            color: #94a3b8;
        }

        .semester-body {
            padding: 1.25rem;
            min-height: 200px;
            position: relative;
        }

        .drop-zone {
            min-height: 160px;
            border: 2px dashed transparent;
            border-radius: 0.75rem;
            padding: 0.5rem;
            transition: all 0.3s ease;
        }

        .drop-zone.drag-over {
            border-color: #60a5fa;
            background: rgba(96, 165, 250, 0.05);
        }

        /* Course Cards */
        .course {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
            cursor: grab;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .course:active {
            cursor: grabbing;
        }

        .course:hover {
            transform: translateY(-2px);
            border-color: rgba(96, 165, 250, 0.4);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .course.dragging {
            opacity: 0.5;
            transform: rotate(5deg) scale(1.05);
            z-index: 1000;
        }

        .course::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background: linear-gradient(135deg, #60a5fa, #a78bfa);
            transition: width 0.3s ease;
        }

        .course:hover::before {
            width: 5px;
        }

        .course-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }

        .course-code {
            font-weight: 600;
            font-size: 0.9rem;
            color: #f1f5f9;
        }

        .course-credits {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .course-title {
            font-size: 0.8rem;
            color: #94a3b8;
            line-height: 1.3;
        }

        .course-actions {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            opacity: 0;
            transition: opacity 0.2s ease;
            display: flex;
            gap: 0.25rem;
        }

        .course:hover .course-actions {
            opacity: 1;
        }

        .course-action-btn {
            width: 20px;
            height: 20px;
            border: none;
            border-radius: 50%;
            background: rgba(148, 163, 184, 0.2);
            color: #94a3b8;
            cursor: pointer;
            font-size: 0.7rem;
            transition: all 0.2s ease;
        }

        .course-action-btn:hover {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        /* Course Types */
        .physics-core::before { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .math-core::before { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .math-minor::before { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .physics-option::before { background: linear-gradient(135deg, #a855f7, #9333ea); }
        .stem-elective::before { background: linear-gradient(135deg, #10b981, #059669); }
        .liberal-learning::before { background: linear-gradient(135deg, #6b7280, #4b5563); }
        .capstone::before { background: linear-gradient(135deg, #f97316, #ea580c); }

        /* Course Bank */
        .course-bank {
            background: rgba(15, 15, 35, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.1);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .course-bank h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #f1f5f9;
        }

        .course-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .course-category {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(148, 163, 184, 0.1);
            border-radius: 0.75rem;
            padding: 1rem;
        }

        .category-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #e2e8f0;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        }

        .course-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #1e293b;
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 1rem;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #f1f5f9;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #94a3b8;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 0.25rem;
            transition: color 0.2s ease;
        }

        .close-btn:hover {
            color: #ef4444;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #e2e8f0;
            margin-bottom: 0.5rem;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 0.5rem;
            color: #f1f5f9;
            font-size: 0.875rem;
            transition: border-color 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #60a5fa;
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.1);
        }

        .form-select {
            width: 100%;
            padding: 0.75rem;
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 0.5rem;
            color: #f1f5f9;
            font-size: 0.875rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                align-items: flex-start;
            }

            .semester-grid {
                grid-template-columns: 1fr;
            }

            .stats-content {
                grid-template-columns: repeat(2, 1fr);
            }

            .main-content {
                padding: 1rem;
            }
        }

        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .course {
            animation: slideIn 0.3s ease;
        }

        /* Add Course Button */
        .add-course-btn {
            width: 100%;
            padding: 1rem;
            border: 2px dashed rgba(148, 163, 184, 0.3);
            background: transparent;
            color: #94a3b8;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }

        .add-course-btn:hover {
            border-color: #60a5fa;
            color: #60a5fa;
            background: rgba(96, 165, 250, 0.05);
        }

        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .fab:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(59, 130, 246, 0.4);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-title">
                    <h1>TCNJ Physics Course Planner</h1>
                    <p>Interactive 4-Year Academic Planning Tool</p>
                </div>
                <div class="header-controls">
                    <button class="btn btn-secondary" onclick="exportPlan()">üìÑ Export</button>
                    <button class="btn btn-secondary" onclick="importPlan()">üìÅ Import</button>
                    <button class="btn btn-primary" onclick="savePlan()">üíæ Save Plan</button>
                </div>
            </div>
        </header>

        <!-- Stats Bar -->
        <div class="stats-bar">
            <div class="stats-content">
                <div class="stat-item">
                    <span class="stat-number" id="totalCredits">128</span>
                    <span class="stat-label">Total Credits</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="physicsCredits">64</span>
                    <span class="stat-label">Physics Credits</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="mathCredits">20</span>
                    <span class="stat-label">Math Credits</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="completedSemesters">0/8</span>
                    <span class="stat-label">Completed</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="avgCredits">16</span>
                    <span class="stat-label">Avg/Semester</span>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <div class="planner-container">
                <!-- Course Bank -->
                <div class="course-bank">
                    <h3>Course Bank - Drag courses to semesters</h3>
                    <div class="course-categories">
                        <div class="course-category">
                            <div class="category-title">Physics Core</div>
                            <div class="course-list" id="physics-core-bank">
                                <!-- Physics core courses will be populated here -->
                            </div>
                        </div>
                        <div class="course-category">
                            <div class="category-title">Mathematics</div>
                            <div class="course-list" id="math-bank">
                                <!-- Math courses will be populated here -->
                            </div>
                        </div>
                        <div class="course-category">
                            <div class="category-title">Physics Options</div>
                            <div class="course-list" id="physics-options-bank">
                                <!-- Physics option courses will be populated here -->
                            </div>
                        </div>
                        <div class="course-category">
                            <div class="category-title">STEM Electives</div>
                            <div class="course-list" id="stem-bank">
                                <!-- STEM electives will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Semester Grid -->
                <div class="semester-grid">
                    <!-- 8 semesters will be generated dynamically -->
                </div>
            </div>
        </main>

        <!-- Floating Action Button -->
        <button class="fab" onclick="addCustomCourse()" title="Add Custom Course">+</button>
    </div>

    <!-- Modal for Course Details -->
    <div class="modal" id="courseModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Course Details</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalBody">
                <!-- Modal content will be populated dynamically -->
            </div>
        </div>
    </div>

    <!-- Modal for Adding Custom Course -->
    <div class="modal" id="addCourseModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add Custom Course</h2>
                <button class="close-btn" onclick="closeAddCourseModal()">&times;</button>
            </div>
            <form id="addCourseForm">
                <div class="form-group">
                    <label class="form-label">Course Code</label>
                    <input type="text" class="form-input" id="courseCode" placeholder="e.g., PHY 425" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Course Title</label>
                    <input type="text" class="form-input" id="courseTitle" placeholder="e.g., Plasma Physics" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Credits</label>
                    <input type="number" class="form-input" id="courseCredits" min="0" max="8" value="4" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Course Type</label>
                    <select class="form-select" id="courseType" required>
                        <option value="physics-core">Physics Core</option>
                        <option value="math-core">Math Core</option>
                        <option value="physics-option">Physics Option</option>
                        <option value="stem-elective">STEM Elective</option>
                        <option value="liberal-learning">Liberal Learning</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Description (Optional)</label>
                    <textarea class="form-input" id="courseDescription" rows="3" placeholder="Course description..."></textarea>
                </div>
                <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                    <button type="button" class="btn btn-secondary" onclick="closeAddCourseModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Course</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Course data
        const courseDatabase = {
            'PHY099': { title: 'Orientation to Physics', credits: 0, type: 'physics-core', description: 'Required entry course covering degree requirements and academic advisement.' },
            'PHY203': { title: 'Physics I for Physicists', credits: 4, type: 'physics-core', description: 'Accelerated calculus-based introductory physics for Physics majors.' },
            'PHY204': { title: 'Physics II for Physicists', credits: 4, type: 'physics-core', description: 'Electricity and magnetism, optics, and thermal physics.' },
            'PHY299': { title: 'Research Fundamentals', credits: 1, type: 'physics-core', description: 'Introduction to physics research methods and scientific writing.' },
            'PHY306': { title: 'Mathematical Physics I', credits: 4, type: 'physics-core', description: 'Mathematical methods including complex analysis and differential equations.' },
            'PHY321': { title: 'Modern Physics', credits: 4, type: 'physics-core', description: 'Quantum mechanics, atomic physics, and special relativity.' },
            'PHY356': { title: 'Thermal Physics', credits: 4, type: 'physics-core', description: 'Thermodynamics and statistical mechanics.' },
            'PHY401': { title: 'Classical Mechanics', credits: 4, type: 'physics-core', description: 'Advanced classical mechanics with Lagrangian formulation.' },
            'PHY421': { title: 'Electromagnetic Theory I', credits: 4, type: 'physics-core', description: 'Maxwell equations and electromagnetic waves.' },
            'PHY451': { title: 'Advanced Experimental Physics', credits: 4, type: 'capstone', description: 'Capstone laboratory course with independent projects.' },
            
            'MAT127': { title: 'Calculus A', credits: 4, type: 'math-core', description: 'Beginning calculus with differentiation and integration.' },
            'MAT128': { title: 'Calculus B', credits: 4, type: 'math-core', description: 'Transcendental functions, series, and integration methods.' },
            'MAT229': { title: 'Multivariable Calculus', credits: 4, type: 'math-minor', description: 'Vector calculus and multidimensional analysis.' },
            'MAT200': { title: 'Discrete Mathematics', credits: 4, type: 'math-minor', description: 'Logic, proof techniques, and combinatorics.' },
            'MAT205': { title: 'Linear Algebra', credits: 4, type: 'math-minor', description: 'Vector spaces, matrices, and eigenvalues.' },
            'MAT326': { title: 'Differential Equations', credits: 4, type: 'math-minor', description: 'Ordinary differential equations and applications.' },
            'MAT316': { title: 'Probability', credits: 4, type: 'math-minor', description: 'Probability theory and random variables.' },
            
            'PHY311': { title: 'Analog & Digital Electronics', credits: 4, type: 'physics-option', description: 'Circuit analysis and digital logic with lab.' },
            'PHY411': { title: 'Optics & Wave Motion', credits: 4, type: 'physics-option', description: 'Geometric and physical optics, interference, diffraction.' },
            'PHY422': { title: 'Electromagnetic Theory II', credits: 4, type: 'physics-option', description: 'Advanced electromagnetic theory and radiation.' },
            'PHY431': { title: 'Quantum Mechanics', credits: 4, type: 'physics-option', description: 'Schr√∂dinger equation and quantum applications.' },
            'PHY413': { title: 'General Relativity & Cosmology', credits: 4, type: 'physics-option', description: 'Einstein relativity and cosmological models.' },
            'PHY425': { title: 'Plasma Physics', credits: 4, type: 'physics-option', description: 'Physics of ionized gases and plasma applications.' },
            'PHY426': { title: 'Nuclear & Particle Physics', credits: 4, type: 'physics-option', description: 'Nuclear structure and elementary particles.' },
            
            'CHE201': { title: 'General Chemistry I', credits: 4, type: 'stem-elective', description: 'Fundamental chemistry principles with lab.' },
            'CHE202': { title: 'General Chemistry II', credits: 4, type: 'stem-elective', description: 'Advanced chemistry topics with lab.' },
            'CSC220': { title: 'Computational Problem Solving', credits: 4, type: 'stem-elective', description: 'Programming for scientific applications.' },
            'BIO201': { title: 'Foundations of Biology', credits: 4, type: 'stem-elective', description: 'Introduction to biological principles.' },
            'ENG272': { title: 'Advanced Engineering Math', credits: 4, type: 'stem-elective', description: 'Mathematical methods for engineering.' }
        };

        // App state
        let semesters = Array(8).fill().map(() => []);
        let courseBank = {
            'physics-core': ['PHY099', 'PHY203', 'PHY204', 'PHY299', 'PHY306', 'PHY321', 'PHY356', 'PHY401', 'PHY421'],
            'math': ['MAT127', 'MAT128', 'MAT229', 'MAT200', 'MAT205', 'MAT326', 'MAT316'],
            'physics-options': ['PHY311', 'PHY411', 'PHY422', 'PHY431', 'PHY413', 'PHY425', 'PHY426', 'PHY451'],
            'stem': ['CHE201', 'CHE202', 'CSC220', 'BIO201', 'ENG272']
        };

        // Initialize the app
        function initializeApp() {
            createSemesters();
            populateCourseBank();
            loadDefaultPlan();
            updateStats();
        }

        function createSemesters() {
            const grid = document.querySelector('.semester-grid');
            const semesterNames = [
                'Fall Freshman', 'Spring Freshman',
                'Fall Sophomore', 'Spring Sophomore', 
                'Fall Junior', 'Spring Junior',
                'Fall Senior', 'Spring Senior'
            ];

            semesterNames.forEach((name, index) => {
                const semester = document.createElement('div');
                semester.className = 'semester';
                semester.innerHTML = `
                    <div class="semester-header">
                        <div class="semester-title">${name}</div>
                        <div class="semester-credits">0 credits</div>
                    </div>
                    <div class="semester-body">
                        <div class="drop-zone" data-semester="${index}">
                            <button class="add-course-btn" onclick="showAddCourseToSemester(${index})">
                                + Add Course
                            </button>
                        </div>
                    </div>
                `;
                grid.appendChild(semester);
            });

            setupDragAndDrop();
        }

        function populateCourseBank() {
            Object.entries(courseBank).forEach(([category, courses]) => {
                const container = document.getElementById(`${category.replace('-', '-')}-bank`);
                if (!container) return;

                courses.forEach(courseCode => {
                    const course = courseDatabase[courseCode];
                    if (course) {
                        container.appendChild(createCourseElement(courseCode, course));
                    }
                });
            });
        }

        function createCourseElement(code, course) {
            const element = document.createElement('div');
            element.className = `course ${course.type}`;
            element.draggable = true;
            element.dataset.course = code;
            element.innerHTML = `
                <div class="course-header">
                    <div class="course-code">${code}</div>
                    <div class="course-credits">${course.credits}</div>
                </div>
                <div class="course-title">${course.title}</div>
                <div class="course-actions">
                    <button class="course-action-btn" onclick="removeCourse('${code}')" title="Remove">√ó</button>
                </div>
            `;

            element.addEventListener('click', () => showCourseDetails(code, course));
            return element;
        }

        function setupDragAndDrop() {
            // Drag start
            document.addEventListener('dragstart', (e) => {
                if (e.target.classList.contains('course')) {
                    e.target.classList.add('dragging');
                    e.dataTransfer.setData('text/plain', e.target.dataset.course);
                }
            });

            // Drag end
            document.addEventListener('dragend', (e) => {
                if (e.target.classList.contains('course')) {
                    e.target.classList.remove('dragging');
                }
            });

            // Drop zone events
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    zone.classList.add('drag-over');
                });

                zone.addEventListener('dragleave', (e) => {
                    if (!zone.contains(e.relatedTarget)) {
                        zone.classList.remove('drag-over');
                    }
                });

                zone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    zone.classList.remove('drag-over');
                    
                    const courseCode = e.dataTransfer.getData('text/plain');
                    const semesterIndex = parseInt(zone.dataset.semester);
                    
                    addCourseToSemester(courseCode, semesterIndex);
                });
            });
        }

        function addCourseToSemester(courseCode, semesterIndex) {
            const course = courseDatabase[courseCode];
            if (!course) return;

            // Remove from current location
            semesters.forEach(semester => {
                const index = semester.indexOf(courseCode);
                if (index > -1) {
                    semester.splice(index, 1);
                }
            });

            // Add to new semester
            semesters[semesterIndex].push(courseCode);
            
            // Remove from DOM
            const existingElement = document.querySelector(`[data-course="${courseCode}"]`);
            if (existingElement && existingElement.parentNode.classList.contains('drop-zone')) {
                existingElement.remove();
            }

            // Add to new semester in DOM
            const dropZone = document.querySelector(`[data-semester="${semesterIndex}"]`);
            const courseElement = createCourseElement(courseCode, course);
            dropZone.insertBefore(courseElement, dropZone.querySelector('.add-course-btn'));

            updateSemesterCredits();
            updateStats();
        }

        function removeCourse(courseCode) {
            // Remove from semesters
            semesters.forEach(semester => {
                const index = semester.indexOf(courseCode);
                if (index > -1) {
                    semester.splice(index, 1);
                }
            });

            // Remove from DOM
            const element = document.querySelector(`[data-course="${courseCode}"]`);
            if (element) {
                element.remove();
            }

            updateSemesterCredits();
            updateStats();
        }

        function updateSemesterCredits() {
            semesters.forEach((semesterCourses, index) => {
                const credits = semesterCourses.reduce((sum, courseCode) => {
                    return sum + (courseDatabase[courseCode]?.credits || 0);
                }, 0);

                const header = document.querySelectorAll('.semester-credits')[index];
                if (header) {
                    header.textContent = `${credits} credits`;
                }
            });
        }

        function updateStats() {
            const totalCredits = semesters.reduce((sum, semesterCourses) => {
                return sum + semesterCourses.reduce((semSum, courseCode) => {
                    return semSum + (courseDatabase[courseCode]?.credits || 0);
                }, 0);
            }, 0);

            const physicsCredits = semesters.reduce((sum, semesterCourses) => {
                return sum + semesterCourses.reduce((semSum, courseCode) => {
                    const course = courseDatabase[courseCode];
                    return semSum + (course && (course.type.includes('physics') || course.type === 'capstone') ? course.credits : 0);
                }, 0);
            }, 0);

            const mathCredits = semesters.reduce((sum, semesterCourses) => {
                return sum + semesterCourses.reduce((semSum, courseCode) => {
                    const course = courseDatabase[courseCode];
                    return semSum + (course && course.type.includes('math') ? course.credits : 0);
                }, 0);
            }, 0);

            const completedSemesters = semesters.filter(sem => sem.length > 0).length;
            const avgCredits = completedSemesters > 0 ? Math.round(totalCredits / completedSemesters) : 0;

            document.getElementById('totalCredits').textContent = totalCredits;
            document.getElementById('physicsCredits').textContent = physicsCredits;
            document.getElementById('mathCredits').textContent = mathCredits;
            document.getElementById('completedSemesters').textContent = `${completedSemesters}/8`;
            document.getElementById('avgCredits').textContent = avgCredits;
        }

        function loadDefaultPlan() {
            const defaultPlan = [
                ['PHY099', 'MAT127', 'PHY203'], // Fall Freshman
                ['MAT128', 'PHY204', 'CHE201'], // Spring Freshman
                ['MAT229', 'PHY299', 'PHY306', 'CHE202'], // Fall Sophomore
                ['PHY321', 'MAT200', 'PHY311'], // Spring Sophomore
                ['PHY401', 'PHY356', 'MAT326'], // Fall Junior
                ['PHY421', 'PHY431', 'MAT205', 'CSC220'], // Spring Junior
                ['PHY422', 'PHY411', 'MAT316'], // Fall Senior
                ['PHY451', 'PHY413'] // Spring Senior
            ];

            defaultPlan.forEach((semesterCourses, semesterIndex) => {
                semesterCourses.forEach(courseCode => {
                    addCourseToSemester(courseCode, semesterIndex);
                });
            });
        }

        function showCourseDetails(code, course) {
            const modal = document.getElementById('courseModal');
            const title = document.getElementById('modalTitle');
            const body = document.getElementById('modalBody');

            title.textContent = `${code}: ${course.title}`;
            body.innerHTML = `
                <div class="form-group">
                    <strong>Credits:</strong> ${course.credits}
                </div>
                <div class="form-group">
                    <strong>Type:</strong> ${course.type.replace('-', ' ').toUpperCase()}
                </div>
                <div class="form-group">
                    <strong>Description:</strong> ${course.description}
                </div>
            `;

            modal.classList.add('active');
        }

        function closeModal() {
            document.getElementById('courseModal').classList.remove('active');
        }

        function addCustomCourse() {
            document.getElementById('addCourseModal').classList.add('active');
        }

        function closeAddCourseModal() {
            document.getElementById('addCourseModal').classList.remove('active');
            document.getElementById('addCourseForm').reset();
        }

        document.getElementById('addCourseForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const code = document.getElementById('courseCode').value.toUpperCase();
            const title = document.getElementById('courseTitle').value;
            const credits = parseInt(document.getElementById('courseCredits').value);
            const type = document.getElementById('courseType').value;
            const description = document.getElementById('courseDescription').value || 'Custom course';

            courseDatabase[code] = { title, credits, type, description };
            
            // Add to appropriate bank
            const bankId = type.includes('physics') ? 'physics-options-bank' : 
                         type.includes('math') ? 'math-bank' :
                         type.includes('stem') ? 'stem-bank' : 'physics-options-bank';
            
            const bank = document.getElementById(bankId);
            if (bank) {
                bank.appendChild(createCourseElement(code, courseDatabase[code]));
            }

            closeAddCourseModal();
        });

        function savePlan() {
            const planData = {
                semesters: semesters,
                customCourses: Object.fromEntries(
                    Object.entries(courseDatabase).filter(([code]) => 
                        !['PHY099', 'PHY203', 'PHY204', 'PHY299', 'PHY306', 'PHY321', 'PHY356', 'PHY401', 'PHY421', 'PHY451',
                         'MAT127', 'MAT128', 'MAT229', 'MAT200', 'MAT205', 'MAT326', 'MAT316',
                         'PHY311', 'PHY411', 'PHY422', 'PHY431', 'PHY413', 'PHY425', 'PHY426',
                         'CHE201', 'CHE202', 'CSC220', 'BIO201', 'ENG272'].includes(code)
                    )
                )
            };

            localStorage.setItem('tcnj-physics-plan', JSON.stringify(planData));
            alert('Plan saved successfully!');
        }

        function exportPlan() {
            const planData = {
                semesters: semesters,
                customCourses: Object.fromEntries(
                    Object.entries(courseDatabase).filter(([code]) => 
                        !['PHY099', 'PHY203', 'PHY204', 'PHY299', 'PHY306', 'PHY321', 'PHY356', 'PHY401', 'PHY421', 'PHY451',
                         'MAT127', 'MAT128', 'MAT229', 'MAT200', 'MAT205', 'MAT326', 'MAT316',
                         'PHY311', 'PHY411', 'PHY422', 'PHY431', 'PHY413', 'PHY425', 'PHY426',
                         'CHE201', 'CHE202', 'CSC220', 'BIO201', 'ENG272'].includes(code)
                    )
                )
            };

            const blob = new Blob([JSON.stringify(planData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'tcnj-physics-plan.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function importPlan() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const planData = JSON.parse(e.target.result);
                            // Load plan logic here
                            alert('Plan imported successfully!');
                        } catch (error) {
                            alert('Error importing plan: Invalid file format');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // Close modals when clicking outside
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('active');
            }
        });

        // Initialize the app when page loads
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
